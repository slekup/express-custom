"use strict";var te=Object.create;var N=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var o=(s,e)=>N(s,"name",{value:e,configurable:!0});var ae=(s,e)=>{for(var t in e)N(s,t,{get:e[t],enumerable:!0})},G=(s,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of se(e))!oe.call(s,u)&&u!==t&&N(s,u,{get:()=>e[u],enumerable:!(a=re(e,u))||a.enumerable});return s};var d=(s,e,t)=>(t=s!=null?te(ie(s)):{},G(e||!s||!s.__esModule?N(t,"default",{value:s,enumerable:!0}):t,s)),ne=s=>G(N({},"__esModule",{value:!0}),s);var ge={};ae(ge,{Api:()=>q,Endpoint:()=>C,Group:()=>k,Route:()=>P,Schema:()=>p,Structure:()=>B,Version:()=>I,default:()=>fe});module.exports=ne(ge);var Y=d(require("dotenv")),ee=d(require("express"));var M=d(require("fs")),U=d(require("path"));var n=class extends Error{constructor(e){super(e),this.name="ExpressCustomError",this.stack=""}};o(n,"ExpressCustomError");var g=d(require("colors")),f=d(require("winston"));var ue=o(s=>{switch(s){case"error":return g.default.red(s.toUpperCase());case"warn":return g.default.yellow(s.toUpperCase());case"info":return g.default.green(s.toUpperCase());case"debug":return g.default.blue(s.toUpperCase());case"trace":return g.default.magenta(s.toUpperCase());default:return g.default.white(s.toUpperCase())}},"levelColor"),pe=f.format.combine(f.format.colorize(),f.format.ms(),f.format.errors({stack:!0}),f.format.printf(({ms:s,level:e,message:t,stack:a})=>{let u=t;a&&(u+=`
${a}`);let r=/\u001b\[[0-9]{1,2}m/gi;return`[${g.default.gray("express-custom")}] ${g.default.cyan(s)} [${ue(e.replace(r,""))}]: ${u}`})),me=f.createLogger({level:"debug",format:pe,transports:[new f.transports.Console({level:"info"})]}),y=me;var _=o(s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),"validateEmail"),H=o(s=>/^[a-zA-Z0-9_]{3,16}$/.test(s),"validateUsername"),J=o(s=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(s),"valiedatePassword"),z=o(s=>/^\d{10}$/.test(s),"validatePhoneNumber"),Z=o(s=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(s),"validateIpv4Address");var D=o(s=>{try{return new URL(s).href===s}catch{return!1}},"validateUrl"),W=o(s=>/^\/(?:[a-zA-Z0-9_]+\/)?[a-zA-Z0-9_]*$/.test(s),"validatePath"),Q=o(s=>{try{return new URL(s).href===s}catch{return!1}},"validateImage");function le(s,e,t){e.status(404).json({status:404,message:"The server cannot find the requested resource"}),t()}o(le,"notFound");function ce(s,e,t){y.error(s.message),t.status(500).json({status:500,message:"Internal Server Error",field:s.field})}o(ce,"errorHandler");var A={notFound:le,errorHandler:ce};function F(s){return(e,t)=>{(async()=>{try{await s(e,t)}catch(a){y.error(a),t.status(500).json({status:500,message:"Internal Server Error"})}})()}}o(F,"initController");var v=d(require("colors")),b=d(require("winston")),x={inf:v.default.blue("CLI"),suc:v.default.green("CLI"),err:v.default.red("CLI")},Ae={inf:v.default.blue("SITE"),suc:v.default.green("SITE"),err:v.default.red("SITE")},he=b.format.combine(b.format.colorize(),b.format.errors({stack:!0}),b.format.printf(({message:s,stack:e})=>{let t=s;return e&&(t+=`
${e}`),t})),de=b.createLogger({level:"info",format:he,transports:[new b.transports.Console({level:"info"})]}),w=de;var L=d(require("express")),X=require("express-rate-limit");var h=class{raw;ratelimit;middlewares;constructor(e="router"){e==="app"?this.raw=(0,L.default)():this.raw=(0,L.Router)(),this.middlewares=[]}setRateLimit(e){if(this.ratelimit)throw new n("Rate limit already set.");return this.ratelimit={statusCode:e.statusCode??429,...typeof e.windowMs=="number"?{window:e.windowMs}:{},...typeof e.max=="number"?{max:e.max}:{}},this.raw.use((0,X.rateLimit)(e)),this}addMiddleware(e){return this.middlewares.push(e),this.raw.use(e),this}};o(h,"BaseApp");var c=class{name;description;required;checks;structure;defaultValue;constructor(e){this.name=e.name,e.description&&(this.description=e.description),this.required=e.required??!1,this.checks=e.checks??[],e.structure&&(this.structure=e.structure),this.defaultValue=e.defaultValue,this.validate()}validate(){if(!this.name)throw new Error("Name is required");if(typeof this.name!="string")throw new Error("Name must be a string");if(this.description&&typeof this.description!="string")throw new Error("Description must be a string");if(typeof this.required!="boolean")throw new Error("Required must be a boolean");if(!Array.isArray(this.checks))throw new Error("Checks must be an array");if(this.structure&&typeof this.structure!="string")throw new Error("Structure must be a string")}};o(c,"BaseValue");var S=class extends c{type="array";min;max;unique;contains;items;constructor({min:e,max:t,unique:a,contains:u,items:r,...i}){super(i),e&&(this.min=e),t&&(this.max=t),this.unique=a??!1,u&&(this.contains=u),r&&(this.items=r)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure,max:this.max,min:this.min,unique:this.unique}}};o(S,"ArrayValueBuilder");var V=class extends c{type="boolean";constructor(e){super(e)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o(V,"BooleanValueBuilder");var R=class extends c{type="image";constructor(e){super(e)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o(R,"ImageValueBuilder");var E=class extends c{type="integer";min;max;constructor(e){super(e),e.min&&(this.min=e.min),e.max&&(this.max=e.max)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o(E,"IntegerValueBuilder");var $=class extends c{type="number";min;max;constructor(e){super(e),e.min&&(this.min=e.min),e.max&&(this.max=e.max)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o($,"NumberValueBuilder");var T=class extends c{type="object";properties;constructor(e){super(e),this.properties={}}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o(T,"ObjectValueBuilder");var O=class extends c{type="string";min;max;options;test;constructor(e){super(e),e.min&&(this.min=e.min),e.max&&(this.max=e.max),e.options&&(this.options=e.options),e.test&&(this.test=e.test)}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};o(O,"StringValueBuilder");var p=class{schema;constructor(){this.schema={}}addArray(e){let t=new S(e);return this.schema[t.name]=t,this}addString(e){let t=new O(e);return this.schema[t.name]=t,this}addNumber(e){let t=new $(e);return this.schema[t.name]=t,this}addInteger(e){let t=new E(e);return this.schema[t.name]=t,this}addBoolean(e){let t=new V(e);return this.schema[t.name]=t,this}addObject(e){let t=new T(e);return this.schema[t.name]=t,this}addImage(e){let t=new R(e);return this.schema[t.name]=t,this}async validateBase(e,t,a){if(typeof e!="object")return"The data provided must be an object.";let u=Object.entries(t);for(let[r,i]of u){if(i.required){if(!e[r]&&i.defaultValue){e[r]=i.defaultValue;break}else if(!e[r])return`The field "${r}" has not been provided.`}if(!e[r]&&i.defaultValue)return e[r]=i.defaultValue,!1;if(!e[r])return!1}for(let[r,i]of u)if(typeof e[r]!==i.type)return`The field "${r}" must be of type ${i.type}.`;for(let[r,i]of u){if(i.type==="number"){if(i.min&&i.max&&typeof e[r]=="number"&&(e[r]<i.min||e[r]>i.max))return`The field "${r}" must be between ${i.min} and ${i.max}.`;if(i.min&&typeof e[r]=="number"&&e[r]<i.min)return`The field "${r}" must be at least ${i.min}.`;if(i.max&&typeof e[r]=="number"&&e[r]>i.max)return`The field "${r}" must be less than ${i.max}.`}if(i.type==="integer"){if(i.min&&i.max&&typeof e[r]=="number"&&(e[r]<i.min||e[r]>i.max))return`The field "${r}" must be between ${i.min} and ${i.max}.`;if(i.min&&typeof e[r]=="number"&&e[r]<i.min)return`The field "${r}" must be at least ${i.min}.`;if(i.max&&typeof e[r]=="number"&&e[r]>i.max)return`The field "${r}" must be less than ${i.max}.`;if(typeof e[r]!="number"||!Number.isInteger(e[r]))return`The field "${r}" must be an integer.`}if(i.type==="string"){let m=i,l=e[r];if(i.options&&i.options.length>0&&!i.options.includes(e[r]))return`The field "${r}" is not a valid option.`;if(i.min&&i.max&&(l.length<i.min||l.length>i.max))return`The field "${r}" must be between ${i.min} and ${i.max} characters.`;if(i.min&&l.length<i.min)return`The field "${r}" must be at least ${i.min} characters.`;if(i.max&&l.length>i.max)return`The field "${r}" must be less than ${i.max} characters.`;if(m.test==="email"&&!_(l))return`The field "${r}" must be a valid email address.`;if(m.test==="username"&&!H(l))return`The field "${r}" must be a valid username.`;if(m.test==="passwordStrength"&&!J(l))return`The field "${r}" is too weak to be a valid password.`;if(m.test==="phoneNumber"&&!z(l))return`The field "${r}" must be a valid phone number.`;if(m.test==="ipAddress"&&!Z(l))return`The field "${r}" must be a valid IPv4 address.`;if(m.test==="url"&&!D(l))return`The field "${r}" must be a valid IPv4 address.`;if(m.test==="path"&&!W(l))return`The field "${r}" must be a valid path.`;if(typeof e[r]!="string")return`The field "${r}" must be a string.`}if(i.checks){for(let m of i.checks)if(!await m[0](r))return`${m[1]}.`}if(i.type==="boolean"&&typeof e[r]!="boolean")return`The field "${r}" must be a boolean.`;if(i.type==="object"){if(typeof e[r]!="object")return`The field "${r}" must be an object.`;if(i.properties&&Object.keys(i.properties).length>0){let m=await this.validateBase(e[r],i.properties,!0);if(m)return m}}if(i.type==="array"&&!Array.isArray(e[r]))return`The field "${r}" must be an array.`;if(i.type==="image"){if(typeof e[r]!="string")return`The field "${r}" must be a string.`;if(!Q(e[r]))return`The field "${r}" must be a valid image.`}}return!1}async validate(e,t){let a=await this.validateBase(e,this.schema);return typeof a!="string"?null:t?.res?t.res.status(400).json({status:400,message:a}):a}export(){let e={};return Object.entries(this.schema).forEach(([t,a])=>{let u=a.export();e[t]=u}),e}};o(p,"SchemaBuilder");var q=class extends h{port;versions;groups;url;structures;config;constructor(e){super("app"),new p().addString({name:"url",required:!0,min:1,max:100}).addNumber({name:"port",required:!0,min:0,max:65536}).validate(e).then(a=>{if(typeof a=="string")throw new n(`Api: ${a}`)}),this.versions=[],this.groups=[],this.url=e.url,this.port=e.port,this.structures=e.structures??[]}addVersion(e){this.versions.push(e);let t=e.values();return this.raw.use(t.path,t.raw),this}addGroup(e){this.groups.push(e);let t=e.values();return this.raw.use(t.path,t.raw),this}start(e){return this.validate(),this.raw.get("/",(a,u)=>u.json({message:`Welcome to ${this.config?.name??"the API"}`,versions:this.versions.map(r=>({version:`v${r.values().version}`,url:`${this.url}/v${r.values().version}`}))})),this.raw.use(A.notFound),this.raw.use(A.errorHandler),this.raw.listen(this.port,e)}async loadConfig(){let e={},t=U.default.join(process.cwd(),"express-custom.json");try{let m=await M.default.promises.readFile(t,"utf-8");try{e=JSON.parse(m.toString())}catch(l){throw w.error(`${x.err} Failed to parse config.json file (invalid JSON).`),new n(l)}}catch{w.error(`${x.err} No express-custom.json found, trying package.json`);try{let l=await M.default.promises.readFile(U.default.join(process.cwd(),"package.json"));try{let j=JSON.parse(l.toString())["express-custom"];if(typeof j!="object")throw w.error(`${x.err} Failed to parse express-custom.json (invalid JSON or no "express-custom" block)`),new n("Invalid JSON");e=j}catch(j){throw w.error(`${x.err} Failed to parse express-custom.json (invalid JSON or no "express-custom" block)`),new n(j)}}catch(l){throw w.error(`${x.err} Failed to load express-custom config from package.json`),new n(l)}}let a=/\.ts$|\.js$/,r=await new p().addString({name:"file",required:!0,max:256,checks:[[m=>a.test(m),"The file must be a JavaScript or TypeScript file (.js or .ts)."]]}).addString({name:"output",max:256,defaultValue:"docs"}).addString({name:"name",defaultValue:"My API"}).addString({name:"description",defaultValue:"Made with Express Custom"}).addString({name:"logo",defaultValue:"/logo.png"}).addString({name:"customDir",max:256}).addString({name:"theme",defaultValue:"default"}).addString({name:"codeTheme",defaultValue:"framer"}).addObject({name:"socials",defaultValue:{},properties:{discord:{type:"string"},github:{type:"string"},instagram:{type:"string"},facebook:{type:"string"},linkedin:{type:"string"},youtube:{type:"string"},twitter:{type:"string"},email:{type:"string"}}}).validate(e);typeof r=="string"&&(w.error(`${x.err} Validation error while processing express-config.json`),w.error(`${x.err} Error: ${r}`),process.exit(1));let i=e;return this.config=i,i}async getConfig(){return this.config?this.config:await this.loadConfig()}validate(){if(this.versions.length===0&&this.groups.length===0)throw new n("No versions or groups provided to the API");this.versions.forEach(e=>e.validate()),this.groups.forEach(e=>e.validate())}async export(){if(!this.url)throw new n("The base URL of the API is not set.");if(!this.port)throw new n("The port of the API is not set.");return{...await this.loadConfig(),url:this.url,port:this.port,structures:this.structures.map(t=>t.export()),rateLimit:this.ratelimit,versions:this.versions.map(t=>t.export()),groups:this.groups.map(t=>t.export())}}};o(q,"Api");var C=class{disabled;name;description;path;method;notes;paramSchema;querySchema;bodySchema;responses;controller;ratelimit;constructor(e){this.disabled=e.disabled??!1,this.name=e.name,this.description=e.description,this.path=e.path,this.method=e.method,this.controller=F(e.controller),this.notes=e.notes??[],this.responses=e.responses??[],new p().addBoolean({name:"disabled",required:!1,defaultValue:!1}).addString({name:"name",required:!0,min:1,max:50}).addString({name:"description",required:!0,min:1,max:1e3}).addString({name:"path",required:!0,min:1,max:100,test:"path"}).addString({name:"method",required:!0,min:1,max:100,options:["GET","POST","PATCH","PUT","DELETE","OPTIONS"]}).validate(e).then(a=>{if(typeof a=="string")throw new n(`Endpoint (${e.name||e.path}): ${a}`)})}setNotes(e){return this.notes=e,this}setParamSchema(e){let t=new p;return e(t),this.paramSchema=t,this}setQuerySchema(e){let t=new p;return e(t),this.querySchema=t,this}setBodySchema(e){let t=new p;return e(t),this.bodySchema=t,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=F(e),this}execute=(e,t,a)=>{(async()=>{try{if(this.paramSchema&&await this.paramSchema.validate(e.params,{res:t})||this.querySchema&&await this.querySchema.validate(e.query,{res:t})||this.bodySchema&&await this.bodySchema.validate(e.body,{res:t}))return;this.controller(e,t,a)}catch(u){y.error(u)}})()};export(){return{name:this.name,description:this.description,path:this.path==="/"?"":this.path,method:this.method,notes:this.notes,params:this.paramSchema?this.paramSchema.export():{},queries:this.querySchema?this.querySchema.export():{},body:this.bodySchema?this.bodySchema.export():{},responses:this.responses}}};o(C,"EndpointBuilder");var k=class extends h{path;name;routes;constructor({path:e,name:t}){super(),new p().addString({name:"path",required:!0,min:1,max:100,test:"path"}).addString({name:"name",required:!0,min:1,max:50}).validate({path:e,name:t}).then(u=>{if(typeof u=="string")throw new n(`Group (${t||e}): ${u}`)}),this.path=e,this.name=t,this.routes=[]}addRoute(e){return this.routes.push(e),this.raw.use(this.path,e.raw),this}values(){return{raw:this.raw,ratelimit:this.ratelimit,path:this.path,defaultCategory:this.name,routes:this.routes,middlewares:this.middlewares}}validate(){if(!this.routes.length)throw new n("No routes provided");this.routes.forEach(e=>e.validate())}export(){return{name:this.name,path:this.path,routes:this.routes.map(e=>e.export())}}};o(k,"GroupBuilder");var P=class extends h{path;name;description;endpoints=[];constructor({path:e,name:t,description:a}){super(),new p().addString({name:"path",required:!0,min:1,max:100,test:"path"}).addString({name:"name",required:!0,min:1,max:50}).addString({name:"description",required:!0,min:1,max:1e3}).validate({name:t,description:a,path:e}).then(r=>{if(typeof r=="string")throw new n(`Route (${t||e}): ${r}`)}),this.path=e,this.name=t,this.description=a}addEndpoint(e){this.endpoints.push(e);let t=/\/+/g,a=`${this.path}${e.path}`.replaceAll(t,"/");switch(e.method){case"GET":this.raw.get(a,e.execute);break;case"POST":this.raw.post(a,e.execute);break;case"PUT":this.raw.put(a,e.execute);break;case"PATCH":this.raw.patch(a,e.execute);break;case"DELETE":this.raw.delete(a,e.execute);break;case"OPTIONS":this.raw.options(a,e.execute);break;default:throw new n(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let t of Object.values(e))this.addEndpoint(t);return this}validate(){if(this.endpoints.length===0)throw new n(`Route ${this.name} has no endpoints`)}export(){return{name:this.name,description:this.description,path:this.path,endpoints:this.endpoints.map(e=>e.export())}}};o(P,"RouteBuilder");var B=class{name;type;fields;constructor({name:e,type:t,fields:a}){this.name=e,this.type=t,this.fields=a}export(){return{name:this.name,type:this.type,fields:this.fields}}};o(B,"StructureBuilder");var K=d(require("express-rate-limit"));var I=class extends h{version;groups;constructor({version:e}){super("app"),new p().addNumber({name:"version",required:!0,min:1,max:1e4}).validate({version:e}).then(a=>{if(typeof a=="string")throw new n(a)}),this.groups=[],this.version=e}setRateLimit(e){return this.ratelimit={statusCode:e.statusCode??429,...typeof e.windowMs=="number"?{window:e.windowMs}:{},...typeof e.max=="number"?{max:e.max}:{}},this.raw.use(`v${this.version}`,(0,K.default)(e)),this}addGroup(e){this.groups.push(e);let t=e.values();return this.raw.use(`v${this.version}`,t.raw),this}export(){return{version:this.version,rateLimit:this.ratelimit,groups:this.groups.map(e=>e.export())}}values(){return{path:`/v${this.version}`,raw:this.raw,version:this.version}}validate(){if(!this.groups.length)throw new n("No groups provided");this.groups.forEach(e=>e.validate())}};o(I,"VersionBuilder");Y.default.config();var fe=ee.default;0&&(module.exports={Api,Endpoint,Group,Route,Schema,Structure,Version});
//# sourceMappingURL=index.js.map