"use strict";var P=Object.create;var b=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var U=(t,e)=>{for(var i in e)b(t,i,{get:e[i],enumerable:!0})},S=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of I(e))!O.call(t,s)&&s!==i&&b(t,s,{get:()=>e[s],enumerable:!(r=B(e,s))||r.enumerable});return t};var f=(t,e,i)=>(i=t!=null?P(A(t)):{},S(e||!t||!t.__esModule?b(i,"default",{value:t,enumerable:!0}):i,t)),j=t=>S(b({},"__esModule",{value:!0}),t);var z={};U(z,{EndpointBuilder:()=>l,RouteBuilder:()=>p,SchemaBuilder:()=>d,default:()=>H});module.exports=j(z);var N=f(require("dotenv")),q=f(require("express"));var u=f(require("colors")),o=f(require("winston")),F=!!process.env.DEBUG,V=t=>{switch(t){case"error":return u.default.red(t.toUpperCase());case"warn":return u.default.yellow(t.toUpperCase());case"info":return u.default.green(t.toUpperCase());case"debug":return u.default.blue(t.toUpperCase());case"trace":return u.default.magenta(t.toUpperCase());default:return u.default.white(t.toUpperCase())}},M=o.format.combine(o.format.colorize(),o.format.timestamp(),o.format.ms(),o.format.errors({stack:!0}),o.format.printf(({timestamp:t,ms:e,level:i,message:r,stack:s})=>{let n=r;s&&(n+=`
${s}`);let a=/\u001b\[[0-9]{1,2}m/gi;return`${u.default.gray(t)} (${u.default.magenta(e)}) [${V(i.replace(a,""))}]: ${n}`})),D=o.createLogger({level:"debug",format:M,transports:[new o.transports.Console({level:F?"debug":"info"}),new o.transports.Console({level:"error"}),new o.transports.Console({level:"warn"}),new o.transports.Console({level:"trace"})]}),m=D;var y=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),w=t=>/^[a-zA-Z0-9_]{3,16}$/.test(t),T=t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(t),x=t=>/^\d{10}$/.test(t),v=t=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(t);var $=t=>{try{return new URL(t).href===t}catch{return!1}},R=t=>{try{return new URL(t).href===t}catch{return!1}};var k=async(t,e)=>{if(typeof t!="object")return"The data provided must be an object.";let i=Object.entries(e);for(let[r,s]of i)if(s.required&&!t[r])return`The field "${r}" has not been provided.`;for(let[r,s]of i)if(typeof t[r]!==s.type)return`The field "${r}" must be of type ${s.type}.`;for(let[r,s]of i){if(s.options&&!s.options.includes(t[r]))return`The field "${r}" is not a valid option.`;if(s.type==="number"){if(s.min&&s.max&&typeof t[r]=="number"&&(t[r]<s.min||t[r]>s.max))return`The field "${r}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof t[r]=="number"&&t[r]<s.min)return`The field "${r}" must be at least ${s.min}.`;if(s.max&&typeof t[r]=="number"&&t[r]>s.max)return`The field "${r}" must be less than ${s.max}.`}if(s.type==="integer"){if(s.min&&s.max&&typeof t[r]=="number"&&(t[r]<s.min||t[r]>s.max))return`The field "${r}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof t[r]=="number"&&t[r]<s.min)return`The field "${r}" must be at least ${s.min}.`;if(s.max&&typeof t[r]=="number"&&t[r]>s.max)return`The field "${r}" must be less than ${s.max}.`;if(typeof t[r]!="number"||!Number.isInteger(t[r]))return`The field "${r}" must be an integer.`}if(s.type==="string"){let n=s,a=t[r];if(s.min&&s.max&&(a.length<s.min||a.length>s.max))return`The field "${r}" must be between ${s.min} and ${s.max} characters.`;if(s.min&&a.length<s.min)return`The field "${r}" must be at least ${s.min} characters.`;if(s.max&&a.length>s.max)return`The field "${r}" must be less than ${s.max} characters.`;if(n.test==="email"&&!y(a))return`The field "${r}" must be a valid email address.`;if(n.test==="username"&&!w(a))return`The field "${r}" must be a valid username.`;if(n.test==="passwordStrength"&&!T(a))return`The field "${r}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!x(a))return`The field "${r}" must be a valid phone number.`;if(n.test==="ipAddress"&&!v(a))return`The field "${r}" must be a valid IPv4 address.`;if(n.test==="url"&&!$(a))return`The field "${r}" must be a valid IPv4 address.`;if(typeof t[r]!="string")return`The field "${r}" must be a string.`}if(s.checks){for(let n of s.checks)if(!await n.run(r))return`${n.response}.`}if(s.type==="boolean"&&typeof t[r]!="boolean")return`The field "${r}" must be a boolean.`;if(s.type==="object"){if(typeof t[r]!="object")return`The field "${r}" must be an object.`;if(s.properties){let n=await k(t[r],s.properties);if(n)return n}}if(s.type==="array"){if(!Array.isArray(t[r]))return`The field "${r}" must be an array.`;if(s.items)for(let n of t[r]){if(typeof n!==s.items.type)return`The field "${r}" must be an array of ${s.items.type}.`;if(!s.items.enum.includes(n))return`The field "${r}" must be an array of valid options.`}}if(s.type==="image"){if(typeof t[r]!="string")return`The field "${r}" must be a string.`;if(!R(t[r]))return`The field "${r}" must be a valid image.`}}return!1},G=async(t,e,i)=>{let r=await k(t,e);return r?i.status(400).json({status:400,message:r}):null},h=G;var E=require("mongoose");var L=async(t,e,i,r)=>{let s=await(0,E.startSession)();try{s.startTransaction(),await t(e,i,s),await s.commitTransaction(),r()}catch(n){await s.abortTransaction(),m.error(n),i.status(500).json({error:"Internal Server Error"})}finally{s.endSession()}},g=t=>(e,i,r)=>{L(t,e,i,r)};var l=class{disabled;name;description;url;method;notes;paramSchema;querySchema;bodySchema;responses;controller;constructor(){this.disabled=!1,this.name="Name not provided",this.description="Description not provided",this.url="/",this.method="GET",this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setDisabled(e){return this.disabled=e,this}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}setNotes(e){return this.notes=e,this}setParamSchema(e){return this.paramSchema=e.schema,this}setQuerySchema(e){return this.querySchema=e.schema,this}setBodySchema(e){return this.bodySchema=e.schema,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=g(e),this}execute=(e,i,r)=>{(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?i.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await h(e.params,this.paramSchema,i)||this.querySchema&&await h(e.query,this.querySchema,i)||this.bodySchema&&await h(e.body,this.bodySchema,i)?void 0:this.controller(e,i,r)}catch(s){m.error(s)}})()}};var C=require("express"),p=class{raw=(0,C.Router)();route;name;description;endpoints=[];middlewares=[];constructor(){this.route="/",this.name="Unnamed route",this.description="No description provided.",this.endpoints=[]}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setRoute(e){return this.route=e,this}addMiddleware(e){return this.middlewares.push(e),this}addEndpoint(e){this.endpoints.push(e);let i=`${this.route}${e.url}`.replace("//","/");switch(e.method){case"GET":this.raw.get(i,...this.middlewares,e.controller);break;case"POST":this.raw.post(i,...this.middlewares,e.controller);break;case"PUT":this.raw.put(i,...this.middlewares,e.controller);break;case"PATCH":this.raw.patch(i,...this.middlewares,e.controller);break;case"DELETE":this.raw.delete(i,...this.middlewares,e.controller);break;case"OPTIONS":this.raw.options(i,...this.middlewares,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let i of Object.values(e))this.addEndpoint(i);return this}use(e,i){if(!e)return this;let r=/\/+/g;return this.raw.use(e.replace(r,"/"),i.raw),this}};var c=class{name;type;typeSchema;description;required;options;enum;items;min;max;checks;properties;test;constructor(e){this.name="Name not provided",this.type=e,this.description="Description not provided",this.required=!0}setName(e){return this.name=e,this}setTypeSchema(e){return this.typeSchema=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}setOptions(e){return this.options=e,this}setEnum(e){return this.enum=e,this}setItems(e){return this.items=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setChecks(e){return this.checks=e,this}setProperties(e){return this.properties=e,this}setTest(e){return this.test=e,this}},d=class{schema;constructor(){this.schema={}}addStringValue=e=>{let i=new c("string");return e(i),this.schema[i.name]=i,this};addNumberValue=e=>{let i=new c("number");return e(i),this.schema[i.name]=i,this};addIntegerValue=e=>{let i=new c("integer");return e(i),this.schema[i.name]=i,this};addBooleanValue=e=>{let i=new c("boolean");return e(i),this.schema[i.name]=i,this};addObjectValue=e=>{let i=new c("object");return e(i),this.schema[i.name]=i,this};addArrayValue=e=>{let i=new c("array");return e(i),this.schema[i.name]=i,this};addImageValue=e=>{let i=new c("image");return e(i),this.schema[i.name]=i,this}};N.default.config();var H=q.default;0&&(module.exports={EndpointBuilder,RouteBuilder,SchemaBuilder});
//# sourceMappingURL=index.js.map