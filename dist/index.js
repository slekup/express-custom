"use strict";var A=Object.create;var f=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var V=(t,e)=>{for(var i in e)f(t,i,{get:e[i],enumerable:!0})},y=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of O(e))!j.call(t,r)&&r!==i&&f(t,r,{get:()=>e[r],enumerable:!(s=M(e,r))||s.enumerable});return t};var g=(t,e,i)=>(i=t!=null?A(I(t)):{},y(e||!t||!t.__esModule?f(i,"default",{value:t,enumerable:!0}):i,t)),F=t=>y(f({},"__esModule",{value:!0}),t);var _={};V(_,{EndpointBuilder:()=>l,RouteBuilder:()=>d,RouterBuilder:()=>b,default:()=>Z});module.exports=F(_);var B=g(require("dotenv")),q=g(require("express"));var h=g(require("colors")),a=g(require("winston")),U=!!process.env.DEBUG,D=t=>{switch(t){case"error":return h.default.red(t.toUpperCase());case"warn":return h.default.yellow(t.toUpperCase());case"info":return h.default.green(t.toUpperCase());case"debug":return h.default.blue(t.toUpperCase());case"trace":return h.default.magenta(t.toUpperCase());default:return h.default.white(t.toUpperCase())}},G=a.format.combine(a.format.colorize(),a.format.timestamp(),a.format.ms(),a.format.errors({stack:!0}),a.format.printf(({timestamp:t,ms:e,level:i,message:s,stack:r})=>{let n=s;r&&(n+=`
${r}`);let o=/\u001b\[[0-9]{1,2}m/gi;return`${h.default.gray(t)} (${h.default.magenta(e)}) [${D(i.replace(o,""))}]: ${n}`})),W=a.createLogger({level:"debug",format:G,transports:[new a.transports.Console({level:U?"debug":"info"}),new a.transports.Console({level:"error"}),new a.transports.Console({level:"warn"}),new a.transports.Console({level:"trace"})]}),p=W;var S=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),x=t=>/^[a-zA-Z0-9_]{3,16}$/.test(t),T=t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(t),v=t=>/^\d{10}$/.test(t),R=t=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(t);var $=t=>{try{return new URL(t).href===t}catch{return!1}},E=t=>{try{return new URL(t).href===t}catch{return!1}};var C=async(t,e)=>{if(typeof t!="object")return"The data provided must be an object.";let i=Object.entries(e);for(let[s,r]of i)if(r.required&&!t[s])return`The field "${s}" has not been provided.`;for(let[s,r]of i)if(typeof t[s]!==r.type)return`The field "${s}" must be of type ${r.type}.`;for(let[s,r]of i){if(r.options&&!r.options.includes(t[s]))return`The field "${s}" is not a valid option.`;if(r.type==="number"){if(r.min&&r.max&&typeof t[s]=="number"&&(t[s]<r.min||t[s]>r.max))return`The field "${s}" must be between ${r.min} and ${r.max}.`;if(r.min&&typeof t[s]=="number"&&t[s]<r.min)return`The field "${s}" must be at least ${r.min}.`;if(r.max&&typeof t[s]=="number"&&t[s]>r.max)return`The field "${s}" must be less than ${r.max}.`}if(r.type==="integer"){if(r.min&&r.max&&typeof t[s]=="number"&&(t[s]<r.min||t[s]>r.max))return`The field "${s}" must be between ${r.min} and ${r.max}.`;if(r.min&&typeof t[s]=="number"&&t[s]<r.min)return`The field "${s}" must be at least ${r.min}.`;if(r.max&&typeof t[s]=="number"&&t[s]>r.max)return`The field "${s}" must be less than ${r.max}.`;if(typeof t[s]!="number"||!Number.isInteger(t[s]))return`The field "${s}" must be an integer.`}if(r.type==="string"){let n=r,o=t[s];if(r.min&&r.max&&(o.length<r.min||o.length>r.max))return`The field "${s}" must be between ${r.min} and ${r.max} characters.`;if(r.min&&o.length<r.min)return`The field "${s}" must be at least ${r.min} characters.`;if(r.max&&o.length>r.max)return`The field "${s}" must be less than ${r.max} characters.`;if(n.test==="email"&&!S(o))return`The field "${s}" must be a valid email address.`;if(n.test==="username"&&!x(o))return`The field "${s}" must be a valid username.`;if(n.test==="passwordStrength"&&!T(o))return`The field "${s}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!v(o))return`The field "${s}" must be a valid phone number.`;if(n.test==="ipAddress"&&!R(o))return`The field "${s}" must be a valid IPv4 address.`;if(n.test==="url"&&!$(o))return`The field "${s}" must be a valid IPv4 address.`;if(typeof t[s]!="string")return`The field "${s}" must be a string.`}if(r.checks){for(let n of r.checks)if(!await n.run(s))return`${n.response}.`}if(r.type==="boolean"&&typeof t[s]!="boolean")return`The field "${s}" must be a boolean.`;if(r.type==="object"){if(typeof t[s]!="object")return`The field "${s}" must be an object.`;if(r.properties){let n=await C(t[s],r.properties);if(n)return n}}if(r.type==="array"){if(!Array.isArray(t[s]))return`The field "${s}" must be an array.`;if(r.items)for(let n of t[s]){if(typeof n!==r.items.type)return`The field "${s}" must be an array of ${r.items.type}.`;if(!r.items.enum.includes(n))return`The field "${s}" must be an array of valid options.`}}if(r.type==="image"){if(typeof t[s]!="string")return`The field "${s}" must be a string.`;if(!E(t[s]))return`The field "${s}" must be a valid image.`}}return!1},L=async(t,e,i)=>{let s=await C(t,e);return s?i.status(400).json({status:400,message:s}):null},c=L;var k=require("mongoose");var z=async(t,e,i,s)=>{let r=await(0,k.startSession)();try{r.startTransaction(),await t(e,i,r),await r.commitTransaction(),s()}catch(n){await r.abortTransaction(),p.error(n),i.status(500).json({error:"Internal Server Error"})}finally{r.endSession()}},w=t=>(e,i,s)=>{z(t,e,i,s)};var u=class{name;type;typeSchema;description;required;options;enum;items;min;max;checks;properties;test;constructor(e){this.name="Name not provided",this.type=e,this.description="Description not provided",this.required=!0}setName(e){return this.name=e,this}setTypeSchema(e){return this.typeSchema=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}setOptions(e){return this.options=e,this}setEnum(e){return this.enum=e,this}setItems(e){return this.items=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setChecks(e){return this.checks=e,this}setProperties(e){return this.properties=e,this}setTest(e){return this.test=e,this}};var m=class{schema;constructor(){this.schema={}}addStringValue(e){let i=new u("string");return e(i),this.schema[i.name]=i,this}addNumberValue(e){let i=new u("number");return e(i),this.schema[i.name]=i,this}addIntegerValue(e){let i=new u("integer");return e(i),this.schema[i.name]=i,this}addBooleanValue(e){let i=new u("boolean");return e(i),this.schema[i.name]=i,this}addObjectValue(e){let i=new u("object");return e(i),this.schema[i.name]=i,this}addArrayValue(e){let i=new u("array");return e(i),this.schema[i.name]=i,this}addImageValue(e){let i=new u("image");return e(i),this.schema[i.name]=i,this}};var l=class{disabled;name;description;path;method;notes;paramSchema;querySchema;bodySchema;responses;controller;constructor(){this.disabled=!1,this.name="Name not provided",this.description="Description not provided",this.path="/",this.method="GET",this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setDisabled(e){return this.disabled=e,this}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}setMethod(e){return this.method=e,this}setNotes(e){return this.notes=e,this}setParamSchema(e){let i=new m;return e(i),this.paramSchema=i.schema,this}setQuerySchema(e){let i=new m;return e(i),this.querySchema=i.schema,this}setBodySchema(e){let i=new m;return e(i),this.bodySchema=i.schema,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=w(e),this}execute(e,i,s){(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?i.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await c(e.params,this.paramSchema,i)||this.querySchema&&await c(e.query,this.querySchema,i)||this.bodySchema&&await c(e.body,this.bodySchema,i)?void 0:this.controller(e,i,s)}catch(r){p.error(r)}})()}export(){return{name:this.name,description:this.description,path:this.path==="/"?"":this.path,method:this.method,notes:this.notes,params:this.paramSchema??{},query:this.querySchema??{},body:this.bodySchema??{},responses:this.responses}}};var P=require("express"),d=class{raw=(0,P.Router)();path;name;description;endpoints=[];middlewares=[];afterwares=[];constructor(e){this.path=e??"/",this.name="Unnamed route",this.description="No description provided."}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addEndpoint(e){this.endpoints.push(e);let i=/\/+/g,s=`${this.path}${e.path}`.replace(i,"/");switch(e.method){case"GET":this.raw.get(s,...this.middlewares,e.controller);break;case"POST":this.raw.post(s,...this.middlewares,e.controller);break;case"PUT":this.raw.put(s,...this.middlewares,e.controller);break;case"PATCH":this.raw.patch(s,...this.middlewares,e.controller);break;case"DELETE":this.raw.delete(s,...this.middlewares,e.controller);break;case"OPTIONS":this.raw.options(s,...this.middlewares,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let i of Object.values(e))this.addEndpoint(i);return this}access(){return{middlewares:this.middlewares,afterwares:this.afterwares}}export(){return{name:this.name,description:this.description,path:this.path,endpoints:this.endpoints.map(e=>e.export())}}};var N=require("express");var b=class{raw=(0,N.Router)();path;defaultCategory;routes=[];middlewares=[];afterwares=[];constructor(){this.path="/",this.defaultCategory="No default category"}setDefaultCategory(e){return this.defaultCategory=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addRoute(e){this.routes.push(e);let i=e.access();return this.raw.use("/",...i.middlewares,e.raw,...i.afterwares),this}getRouter=()=>this.raw;export(){return{name:this.defaultCategory,path:this.path,routes:this.routes.map(e=>e.export())}}async generateSite(){return p.info("Generating site..."),await(()=>new Promise(i=>{setTimeout(()=>{i(null)},1e3)}))(),p.error("Site generation has not been implemented yet."),this}};B.default.config();var Z=q.default;0&&(module.exports={EndpointBuilder,RouteBuilder,RouterBuilder});
//# sourceMappingURL=index.js.map