"use strict";var se=Object.create;var $=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var ue=(r,e,t)=>e in r?$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var le=(r,e)=>{for(var t in e)$(r,t,{get:e[t],enumerable:!0})},U=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of oe(e))!ae.call(r,a)&&a!==t&&$(r,a,{get:()=>e[a],enumerable:!(o=ie(e,a))||o.enumerable});return r};var m=(r,e,t)=>(t=r!=null?se(ne(r)):{},U(e||!r||!r.__esModule?$(t,"default",{value:r,enumerable:!0}):t,r)),pe=r=>U($({},"__esModule",{value:!0}),r);var D=(r,e,t)=>(ue(r,typeof e!="symbol"?e+"":e,t),t);var ve={};le(ve,{ApiBuilder:()=>B,EndpointBuilder:()=>C,RouteBuilder:()=>q,RouterBuilder:()=>N,SchemaBuilder:()=>h,StructureBuilder:()=>k,VersionBuilder:()=>P,default:()=>ye});module.exports=pe(ve);var te=m(require("dotenv")),re=m(require("express"));var M=m(require("fs")),F=m(require("path"));var X=m(require("colors"));var d=m(require("colors")),p=m(require("winston")),me=!!process.env.DEBUG,ce=r=>{switch(r){case"error":return d.default.red(r.toUpperCase());case"warn":return d.default.yellow(r.toUpperCase());case"info":return d.default.green(r.toUpperCase());case"debug":return d.default.blue(r.toUpperCase());case"trace":return d.default.magenta(r.toUpperCase());default:return d.default.white(r.toUpperCase())}},he=p.format.combine(p.format.colorize(),p.format.timestamp(),p.format.ms(),p.format.errors({stack:!0}),p.format.printf(({timestamp:r,ms:e,level:t,message:o,stack:a})=>{let s=o;a&&(s+=`
${a}`);let i=/\u001b\[[0-9]{1,2}m/gi;return`${d.default.gray(r)} (${d.default.magenta(e)}) [${ce(t.replace(i,""))}]: ${s}`})),de=p.createLogger({level:"debug",format:he,transports:[new p.transports.Console({level:me?"debug":"info"}),new p.transports.Console({level:"error"}),new p.transports.Console({level:"warn"}),new p.transports.Console({level:"trace"})]}),g=de;var H=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),J=r=>/^[a-zA-Z0-9_]{3,16}$/.test(r),G=r=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(r),z=r=>/^\d{10}$/.test(r),W=r=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(r);var Z=r=>{try{return new URL(r).href===r}catch{return!1}},Q=r=>{try{return new URL(r).href===r}catch{return!1}};function fe(r,e,t){e.status(404).json({status:404,message:"The server cannot find the requested resource"}),g.error(X.default.red(`The route at ${r.originalUrl} was not found - ${r.method}`)),t()}function be(r,e,t){g.error(r),t.status(r.status||500),t.json({error:{status:r.status||500,message:"Internal Server Error",field:r.field}})}var I={notFound:fe,errorHandler:be};var _=require("mongoose");var ge=async(r,e,t,o)=>{let a=await(0,_.startSession)();try{a.startTransaction(),await r(e,t,a),await a.commitTransaction(),o()}catch(s){await a.abortTransaction(),g.error(s),t.status(500).json({error:"Internal Server Error"})}finally{a.endSession()}},A=r=>(e,t,o)=>{ge(r,e,t,o)};var w=m(require("colors")),f=m(require("winston")),x={inf:w.default.blue("CLI"),suc:w.default.green("CLI"),err:w.default.red("CLI")},Oe={inf:w.default.blue("SITE"),suc:w.default.green("SITE"),err:w.default.red("SITE")},xe=f.format.combine(f.format.colorize(),f.format.errors({stack:!0}),f.format.printf(({message:r,stack:e})=>{let t=r;return e&&(t+=`
${e}`),t})),we=f.createLogger({level:"info",format:xe,transports:[new f.transports.Console({level:"info"})]}),b=we;var O=m(require("express")),K=require("express-rate-limit"),c=class{raw;ratelimit;middlewares;constructor(e="router"){e==="app"?this.raw=(0,O.default)():this.raw=(0,O.Router)(),this.middlewares=[]}setRateLimit(e,t){if(this.ratelimit)throw new Error("Rate limit already set.");return(t||t===void 0)&&(this.ratelimit={statusCode:e.statusCode??429,...typeof e.windowMs=="number"?{window:e.windowMs}:{},...typeof e.max=="number"?{max:e.max}:{}}),this.raw.use((0,K.rateLimit)(e)),this}addMiddleware(e){return this.middlewares.push(e),this.raw.use(e),this}};var l=class{name;description;required;checks;structure;defaultValue;constructor(){this.name="Name not provided",this.description="Description not provided",this.required=!1,this.checks=[]}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}addCheck(e){return this.checks.push(e),this}setStructure(e){return this.structure=e,this}};var y=class extends l{type="array";min;max;unique;contains;items;constructor(){super()}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setUnique(e){return this.unique=e,this}setContains(e,t,o){return this.contains={type:e,...t?{min:t}:{},...o?{max:o}:{}},this}setItems(e){return this.items=e,this}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure,max:this.max,min:this.min,unique:this.unique}}};var v=class extends l{type="boolean";constructor(){super()}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var S=class extends l{type="image";constructor(){super()}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var R=class extends l{type="integer";min;max;constructor(){super()}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var E=class extends l{type="number";min;max;constructor(){super()}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var T=class extends l{type="object";properties;constructor(){super(),this.properties={}}setProperties(e){return this.properties=e,this}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var V=class extends l{type="string";min;max;options;test;constructor(){super()}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setOptions(e){return this.options=e,this}setTest(e){return this.test=e,this}setDefault(e){return this.defaultValue=e,this}export(){return{type:this.type,name:this.name,description:this.description,required:this.required,structure:this.structure}}};var h=class{schema;constructor(){this.schema={}}addArray(e){let t=new y;return e(t),this.schema[t.name]=t,this}addString(e){let t=new V;return e(t),this.schema[t.name]=t,this}addNumber(e){let t=new E;return e(t),this.schema[t.name]=t,this}addInteger(e){let t=new R;return e(t),this.schema[t.name]=t,this}addBoolean(e){let t=new v;return e(t),this.schema[t.name]=t,this}addObject(e){let t=new T;return e(t),this.schema[t.name]=t,this}addImage(e){let t=new S;return e(t),this.schema[t.name]=t,this}async validateBase(e,t,o){if(typeof e!="object")return"The data provided must be an object.";let a=Object.entries(t);for(let[s,i]of a){if(i.required){if(!e[s]&&i.defaultValue){e[s]=i.defaultValue;break}else if(!e[s])return`The field "${s}" has not been provided.`}if(!e[s]&&i.defaultValue)return e[s]=i.defaultValue,!1;if(!e[s])return!1}for(let[s,i]of a)if(typeof e[s]!==i.type)return`The field "${s}" must be of type ${i.type}.`;for(let[s,i]of a){if(i.type==="number"){if(i.min&&i.max&&typeof e[s]=="number"&&(e[s]<i.min||e[s]>i.max))return`The field "${s}" must be between ${i.min} and ${i.max}.`;if(i.min&&typeof e[s]=="number"&&e[s]<i.min)return`The field "${s}" must be at least ${i.min}.`;if(i.max&&typeof e[s]=="number"&&e[s]>i.max)return`The field "${s}" must be less than ${i.max}.`}if(i.type==="integer"){if(i.min&&i.max&&typeof e[s]=="number"&&(e[s]<i.min||e[s]>i.max))return`The field "${s}" must be between ${i.min} and ${i.max}.`;if(i.min&&typeof e[s]=="number"&&e[s]<i.min)return`The field "${s}" must be at least ${i.min}.`;if(i.max&&typeof e[s]=="number"&&e[s]>i.max)return`The field "${s}" must be less than ${i.max}.`;if(typeof e[s]!="number"||!Number.isInteger(e[s]))return`The field "${s}" must be an integer.`}if(i.type==="string"){let n=i,u=e[s];if(i.options&&!i.options.includes(e[s]))return`The field "${s}" is not a valid option.`;if(i.min&&i.max&&(u.length<i.min||u.length>i.max))return`The field "${s}" must be between ${i.min} and ${i.max} characters.`;if(i.min&&u.length<i.min)return`The field "${s}" must be at least ${i.min} characters.`;if(i.max&&u.length>i.max)return`The field "${s}" must be less than ${i.max} characters.`;if(n.test==="email"&&!H(u))return`The field "${s}" must be a valid email address.`;if(n.test==="username"&&!J(u))return`The field "${s}" must be a valid username.`;if(n.test==="passwordStrength"&&!G(u))return`The field "${s}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!z(u))return`The field "${s}" must be a valid phone number.`;if(n.test==="ipAddress"&&!W(u))return`The field "${s}" must be a valid IPv4 address.`;if(n.test==="url"&&!Z(u))return`The field "${s}" must be a valid IPv4 address.`;if(typeof e[s]!="string")return`The field "${s}" must be a string.`}if(i.checks){for(let n of i.checks)if(!await n.run(s))return`${n.response}.`}if(i.type==="boolean"&&typeof e[s]!="boolean")return`The field "${s}" must be a boolean.`;if(i.type==="object"){if(typeof e[s]!="object")return`The field "${s}" must be an object.`;if(i.properties&&Object.keys(i.properties).length>0){let n=await this.validateBase(e[s],i.properties,!0);if(n)return n}}if(i.type==="array"&&!Array.isArray(e[s]))return`The field "${s}" must be an array.`;if(i.type==="image"){if(typeof e[s]!="string")return`The field "${s}" must be a string.`;if(!Q(e[s]))return`The field "${s}" must be a valid image.`}}return!1}async validate(e,t){let o=await this.validateBase(e,this.schema);return typeof o!="string"?null:t?.res?t.res.status(400).json({status:400,message:o}):o}export(){let e={};return Object.entries(this.schema).forEach(([t,o])=>{let a=o.export();e[t]=a}),e}};var L=class extends c{port;versions;baseUrl;structures;constructor({baseUrl:e,port:t,structures:o}){super("app"),this.versions=[],this.baseUrl=e,this.port=t,this.structures=o??[]}addVersion(e){this.versions.push(e);let t=e.values();return this.raw.use(t.path,t.raw),this}startServer(e){return this.raw.get("/",(o,a)=>a.json({message:"Welcome to Slekup API",versions:this.versions.map(s=>({version:`v${s.values().version}`,url:`${this.baseUrl}/v${s.values().version}`}))})),this.raw.use(I.notFound),this.raw.use(I.errorHandler),this.raw.listen(this.port,e)}async export(){if(!this.baseUrl)throw new Error("The base URL of the API is not set.");if(!this.port)throw new Error("The port of the API is not set.");return b.info("Running export"),{...await L.loadConfig(),baseUrl:this.baseUrl,port:this.port,structures:this.structures,rateLimit:this.ratelimit,versions:this.versions.map(t=>t.export())}}},B=L;D(B,"loadConfig",async()=>{let e={},t=F.default.join(process.cwd(),"express-custom.json");try{let n=await M.default.promises.readFile(t,"utf-8");try{e=JSON.parse(n.toString())}catch(u){throw b.error(`${x.err} Failed to parse config.json file (invalid JSON).`),new Error(u)}}catch{b.error(`${x.err} No express-custom.json found, trying package.json`);try{let u=await M.default.promises.readFile(F.default.join(process.cwd(),"package.json"));try{let j=JSON.parse(u.toString())["express-custom"];if(typeof j!="object")throw b.error(`${x.err} Failed to parse express-custom.json (invalid JSON or no "express-custom" block)`),new Error("Invalid JSON");e=j}catch(j){throw b.error(`${x.err} Failed to parse express-custom.json (invalid JSON or no "express-custom" block)`),new Error(j)}}catch(u){throw b.error(`${x.err} Failed to load express-custom config from package.json`),new Error(u)}}let o=/\.ts$|\.js$/,s=await new h().addString(n=>n.setName("file").setRequired(!0).setMax(256).addCheck({run:u=>o.test(u),response:"The file must be a JavaScript or TypeScript file (.js or .ts)."})).addString(n=>n.setName("output").setDefault("docs").setMax(256)).addString(n=>n.setName("name").setDefault("My API")).addString(n=>n.setName("description").setDefault("Made with Express Custom")).addString(n=>n.setName("logo").setDefault("/logo.png")).addString(n=>n.setName("customDir").setMax(256)).addString(n=>n.setName("theme").setDefault("default")).addString(n=>n.setName("codeTheme").setDefault("framer")).addObject(n=>n.setName("socials").setDefault({}).setProperties({discord:{type:"string"},github:{type:"string"},instagram:{type:"string"},facebook:{type:"string"},linkedin:{type:"string"},youtube:{type:"string"},twitter:{type:"string"},email:{type:"string"}})).validate(e);return typeof s=="string"&&(b.error(`${x.err} Validation error while processing express-config.json`),b.error(`${x.err} Error: ${s}`),process.exit(1)),e});var C=class{disabled;name;description;path;method;notes;paramSchema;querySchema;bodySchema;responses;controller;ratelimit;constructor({disabled:e,name:t,description:o,path:a,method:s}){this.disabled=e??!1,this.name=t,this.description=o,this.path=a,this.method=s,this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setNotes(e){return this.notes=e,this}setParamSchema(e){let t=new h;return e(t),this.paramSchema=t,this}setQuerySchema(e){let t=new h;return e(t),this.querySchema=t,this}setBodySchema(e){let t=new h;return e(t),this.bodySchema=t,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=A(e),this}execute(e,t,o){(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?t.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await this.paramSchema.validate(e.params,{res:t})||this.querySchema&&await this.querySchema.validate(e.query,{res:t})||this.bodySchema&&await this.bodySchema.validate(e.body,{res:t})?void 0:this.controller(e,t,o)}catch(a){g.error(a)}})()}export(){return{name:this.name,description:this.description,path:this.path==="/"?"":this.path,method:this.method,notes:this.notes,params:this.paramSchema?this.paramSchema.export():{},queries:this.querySchema?this.querySchema.export():{},body:this.bodySchema?this.bodySchema.export():{},responses:this.responses}}};var Y=require("express");var q=class extends c{raw=(0,Y.Router)();path;name;description;endpoints=[];constructor({name:e,description:t,path:o}){super(),this.path=o,this.name=e,this.description=t}addEndpoint(e){this.endpoints.push(e);let t=/\/+/g,o=`${this.path}${e.path}`.replaceAll(t,"/");switch(e.method){case"GET":this.raw.get(o,e.controller);break;case"POST":this.raw.post(o,e.controller);break;case"PUT":this.raw.put(o,e.controller);break;case"PATCH":this.raw.patch(o,e.controller);break;case"DELETE":this.raw.delete(o,e.controller);break;case"OPTIONS":this.raw.options(o,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let t of Object.values(e))this.addEndpoint(t);return this}export(){return{name:this.name,description:this.description,path:this.path,endpoints:this.endpoints.map(e=>e.export())}}};var N=class extends c{path;name;routes;constructor({path:e,name:t}){super(),this.path=e,this.name=t,this.routes=[]}addRoute(e){return this.routes.push(e),this.raw.use(this.path,e.raw),this}export(){return{name:this.name,path:this.path,routes:this.routes.map(e=>e.export())}}values(){return{raw:this.raw,ratelimit:this.ratelimit,path:this.path,defaultCategory:this.name,routes:this.routes,middlewares:this.middlewares}}};var k=class{name;type;fields;constructor({name:e,type:t,fields:o}){this.name=e,this.type=t,this.fields=o}export(){return{name:this.name,type:this.type,fields:this.fields}}};var ee=m(require("express-rate-limit"));var P=class extends c{version;routers;constructor({version:e}){super("app"),this.routers=[],this.version=e}setRateLimit(e,t){return(t||t===void 0)&&(this.ratelimit={statusCode:e.statusCode??429,...typeof e.windowMs=="number"?{window:e.windowMs}:{},...typeof e.max=="number"?{max:e.max}:{}}),this.raw.use(`v${this.version}`,(0,ee.default)(e)),this}addRouter(e){this.routers.push(e);let t=e.values();return this.raw.use(`v${this.version}`,t.raw),this}export(){return{version:this.version,rateLimit:this.ratelimit,routers:this.routers.map(e=>e.export())}}values(){return{path:`/v${this.version}`,raw:this.raw,version:this.version}}};te.default.config();var ye=re.default;0&&(module.exports={ApiBuilder,EndpointBuilder,RouteBuilder,RouterBuilder,SchemaBuilder,StructureBuilder,VersionBuilder});
//# sourceMappingURL=index.js.map