import O from"dotenv";import I from"express";import h from"colors";import*as a from"winston";var $=!!process.env.DEBUG,E=i=>{switch(i){case"error":return h.red(i.toUpperCase());case"warn":return h.yellow(i.toUpperCase());case"info":return h.green(i.toUpperCase());case"debug":return h.blue(i.toUpperCase());case"trace":return h.magenta(i.toUpperCase());default:return h.white(i.toUpperCase())}},k=a.format.combine(a.format.colorize(),a.format.timestamp(),a.format.ms(),a.format.errors({stack:!0}),a.format.printf(({timestamp:i,ms:e,level:r,message:s,stack:t})=>{let n=s;t&&(n+=`
${t}`);let o=/\u001b\[[0-9]{1,2}m/gi;return`${h.gray(i)} (${h.magenta(e)}) [${E(r.replace(o,""))}]: ${n}`})),C=a.createLogger({level:"debug",format:k,transports:[new a.transports.Console({level:$?"debug":"info"}),new a.transports.Console({level:"error"}),new a.transports.Console({level:"warn"}),new a.transports.Console({level:"trace"})]}),m=C;var g=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),w=i=>/^[a-zA-Z0-9_]{3,16}$/.test(i),S=i=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(i),y=i=>/^\d{10}$/.test(i),x=i=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(i);var T=i=>{try{return new URL(i).href===i}catch{return!1}},v=i=>{try{return new URL(i).href===i}catch{return!1}};var R=async(i,e)=>{if(typeof i!="object")return"The data provided must be an object.";let r=Object.entries(e);for(let[s,t]of r)if(t.required&&!i[s])return`The field "${s}" has not been provided.`;for(let[s,t]of r)if(typeof i[s]!==t.type)return`The field "${s}" must be of type ${t.type}.`;for(let[s,t]of r){if(t.options&&!t.options.includes(i[s]))return`The field "${s}" is not a valid option.`;if(t.type==="number"){if(t.min&&t.max&&typeof i[s]=="number"&&(i[s]<t.min||i[s]>t.max))return`The field "${s}" must be between ${t.min} and ${t.max}.`;if(t.min&&typeof i[s]=="number"&&i[s]<t.min)return`The field "${s}" must be at least ${t.min}.`;if(t.max&&typeof i[s]=="number"&&i[s]>t.max)return`The field "${s}" must be less than ${t.max}.`}if(t.type==="integer"){if(t.min&&t.max&&typeof i[s]=="number"&&(i[s]<t.min||i[s]>t.max))return`The field "${s}" must be between ${t.min} and ${t.max}.`;if(t.min&&typeof i[s]=="number"&&i[s]<t.min)return`The field "${s}" must be at least ${t.min}.`;if(t.max&&typeof i[s]=="number"&&i[s]>t.max)return`The field "${s}" must be less than ${t.max}.`;if(typeof i[s]!="number"||!Number.isInteger(i[s]))return`The field "${s}" must be an integer.`}if(t.type==="string"){let n=t,o=i[s];if(t.min&&t.max&&(o.length<t.min||o.length>t.max))return`The field "${s}" must be between ${t.min} and ${t.max} characters.`;if(t.min&&o.length<t.min)return`The field "${s}" must be at least ${t.min} characters.`;if(t.max&&o.length>t.max)return`The field "${s}" must be less than ${t.max} characters.`;if(n.test==="email"&&!g(o))return`The field "${s}" must be a valid email address.`;if(n.test==="username"&&!w(o))return`The field "${s}" must be a valid username.`;if(n.test==="passwordStrength"&&!S(o))return`The field "${s}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!y(o))return`The field "${s}" must be a valid phone number.`;if(n.test==="ipAddress"&&!x(o))return`The field "${s}" must be a valid IPv4 address.`;if(n.test==="url"&&!T(o))return`The field "${s}" must be a valid IPv4 address.`;if(typeof i[s]!="string")return`The field "${s}" must be a string.`}if(t.checks){for(let n of t.checks)if(!await n.run(s))return`${n.response}.`}if(t.type==="boolean"&&typeof i[s]!="boolean")return`The field "${s}" must be a boolean.`;if(t.type==="object"){if(typeof i[s]!="object")return`The field "${s}" must be an object.`;if(t.properties){let n=await R(i[s],t.properties);if(n)return n}}if(t.type==="array"){if(!Array.isArray(i[s]))return`The field "${s}" must be an array.`;if(t.items)for(let n of i[s]){if(typeof n!==t.items.type)return`The field "${s}" must be an array of ${t.items.type}.`;if(!t.items.enum.includes(n))return`The field "${s}" must be an array of valid options.`}}if(t.type==="image"){if(typeof i[s]!="string")return`The field "${s}" must be a string.`;if(!v(i[s]))return`The field "${s}" must be a valid image.`}}return!1},N=async(i,e,r)=>{let s=await R(i,e);return s?r.status(400).json({status:400,message:s}):null},c=N;import{startSession as B}from"mongoose";var q=async(i,e,r,s)=>{let t=await B();try{t.startTransaction(),await i(e,r,t),await t.commitTransaction(),s()}catch(n){await t.abortTransaction(),m.error(n),r.status(500).json({error:"Internal Server Error"})}finally{t.endSession()}},f=i=>(e,r,s)=>{q(i,e,r,s)};var u=class{name;type;typeSchema;description;required;options;enum;items;min;max;checks;properties;test;constructor(e){this.name="Name not provided",this.type=e,this.description="Description not provided",this.required=!0}setName(e){return this.name=e,this}setTypeSchema(e){return this.typeSchema=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}setOptions(e){return this.options=e,this}setEnum(e){return this.enum=e,this}setItems(e){return this.items=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setChecks(e){return this.checks=e,this}setProperties(e){return this.properties=e,this}setTest(e){return this.test=e,this}};var p=class{schema;constructor(){this.schema={}}addStringValue(e){let r=new u("string");return e(r),this.schema[r.name]=r,this}addNumberValue(e){let r=new u("number");return e(r),this.schema[r.name]=r,this}addIntegerValue(e){let r=new u("integer");return e(r),this.schema[r.name]=r,this}addBooleanValue(e){let r=new u("boolean");return e(r),this.schema[r.name]=r,this}addObjectValue(e){let r=new u("object");return e(r),this.schema[r.name]=r,this}addArrayValue(e){let r=new u("array");return e(r),this.schema[r.name]=r,this}addImageValue(e){let r=new u("image");return e(r),this.schema[r.name]=r,this}};var l=class{disabled;name;description;path;method;notes;paramSchema;querySchema;bodySchema;responses;controller;constructor(){this.disabled=!1,this.name="Name not provided",this.description="Description not provided",this.path="/",this.method="GET",this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setDisabled(e){return this.disabled=e,this}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}setMethod(e){return this.method=e,this}setNotes(e){return this.notes=e,this}setParamSchema(e){let r=new p;return e(r),this.paramSchema=r.schema,this}setQuerySchema(e){let r=new p;return e(r),this.querySchema=r.schema,this}setBodySchema(e){let r=new p;return e(r),this.bodySchema=r.schema,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=f(e),this}execute(e,r,s){(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?r.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await c(e.params,this.paramSchema,r)||this.querySchema&&await c(e.query,this.querySchema,r)||this.bodySchema&&await c(e.body,this.bodySchema,r)?void 0:this.controller(e,r,s)}catch(t){m.error(t)}})()}export(){return{name:this.name,description:this.description,path:this.path,notes:this.notes,params:this.paramSchema??{},query:this.querySchema??{},body:this.bodySchema??{},responses:this.responses}}};import{Router as A}from"express";var d=class{raw=A();path;name;description;endpoints=[];middlewares=[];afterwares=[];constructor(e){this.path=e??"/",this.name="Unnamed route",this.description="No description provided."}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addEndpoint(e){this.endpoints.push(e);let r=`${this.path}${e.path}`.replace("//","/");switch(e.method){case"GET":this.raw.get(r,...this.middlewares,e.controller);break;case"POST":this.raw.post(r,...this.middlewares,e.controller);break;case"PUT":this.raw.put(r,...this.middlewares,e.controller);break;case"PATCH":this.raw.patch(r,...this.middlewares,e.controller);break;case"DELETE":this.raw.delete(r,...this.middlewares,e.controller);break;case"OPTIONS":this.raw.options(r,...this.middlewares,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let r of Object.values(e))this.addEndpoint(r);return this}access(){return{middlewares:this.middlewares,afterwares:this.afterwares}}export(){return{name:this.name,description:this.description,path:this.path,endpoints:this.endpoints.map(e=>e.export())}}};import{Router as M}from"express";var b=class{raw=M();path;name;routes=[];middlewares=[];afterwares=[];constructor(){this.path="/",this.name="Unnamed router"}setName(e){return this.name=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addRoute(e,r){if(!e)return this;let s=/\/+/g,t=r.access();return this.raw.use(e.replace(s,"/"),...t.middlewares,r.raw,...t.afterwares),this}getRouter=()=>this.raw;export(){return{name:this.name,path:this.path,routes:this.routes.map(e=>e.export())}}async generateSite(){return m.info("Generating site..."),await(()=>new Promise(r=>{setTimeout(()=>{r(null)},1e3)}))(),m.error("Site generation has not been implemented yet."),this}};O.config();var xe=I;export{l as EndpointBuilder,d as RouteBuilder,b as RouterBuilder,xe as default};
//# sourceMappingURL=index.mjs.map