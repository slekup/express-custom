import I from"dotenv";import A from"express";import c from"colors";import*as o from"winston";var $=!!process.env.DEBUG,R=r=>{switch(r){case"error":return c.red(r.toUpperCase());case"warn":return c.yellow(r.toUpperCase());case"info":return c.green(r.toUpperCase());case"debug":return c.blue(r.toUpperCase());case"trace":return c.magenta(r.toUpperCase());default:return c.white(r.toUpperCase())}},k=o.format.combine(o.format.colorize(),o.format.timestamp(),o.format.ms(),o.format.errors({stack:!0}),o.format.printf(({timestamp:r,ms:e,level:i,message:t,stack:s})=>{let n=t;s&&(n+=`
${s}`);let a=/\u001b\[[0-9]{1,2}m/gi;return`${c.gray(r)} (${c.magenta(e)}) [${R(i.replace(a,""))}]: ${n}`})),E=o.createLogger({level:"debug",format:k,transports:[new o.transports.Console({level:$?"debug":"info"}),new o.transports.Console({level:"error"}),new o.transports.Console({level:"warn"}),new o.transports.Console({level:"trace"})]}),m=E;var f=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),g=r=>/^[a-zA-Z0-9_]{3,16}$/.test(r),S=r=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(r),y=r=>/^\d{10}$/.test(r),w=r=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(r);var T=r=>{try{return new URL(r).href===r}catch{return!1}},x=r=>{try{return new URL(r).href===r}catch{return!1}};var v=async(r,e)=>{if(typeof r!="object")return"The data provided must be an object.";let i=Object.entries(e);for(let[t,s]of i)if(s.required&&!r[t])return`The field "${t}" has not been provided.`;for(let[t,s]of i)if(typeof r[t]!==s.type)return`The field "${t}" must be of type ${s.type}.`;for(let[t,s]of i){if(s.options&&!s.options.includes(r[t]))return`The field "${t}" is not a valid option.`;if(s.type==="number"){if(s.min&&s.max&&typeof r[t]=="number"&&(r[t]<s.min||r[t]>s.max))return`The field "${t}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof r[t]=="number"&&r[t]<s.min)return`The field "${t}" must be at least ${s.min}.`;if(s.max&&typeof r[t]=="number"&&r[t]>s.max)return`The field "${t}" must be less than ${s.max}.`}if(s.type==="integer"){if(s.min&&s.max&&typeof r[t]=="number"&&(r[t]<s.min||r[t]>s.max))return`The field "${t}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof r[t]=="number"&&r[t]<s.min)return`The field "${t}" must be at least ${s.min}.`;if(s.max&&typeof r[t]=="number"&&r[t]>s.max)return`The field "${t}" must be less than ${s.max}.`;if(typeof r[t]!="number"||!Number.isInteger(r[t]))return`The field "${t}" must be an integer.`}if(s.type==="string"){let n=s,a=r[t];if(s.min&&s.max&&(a.length<s.min||a.length>s.max))return`The field "${t}" must be between ${s.min} and ${s.max} characters.`;if(s.min&&a.length<s.min)return`The field "${t}" must be at least ${s.min} characters.`;if(s.max&&a.length>s.max)return`The field "${t}" must be less than ${s.max} characters.`;if(n.test==="email"&&!f(a))return`The field "${t}" must be a valid email address.`;if(n.test==="username"&&!g(a))return`The field "${t}" must be a valid username.`;if(n.test==="passwordStrength"&&!S(a))return`The field "${t}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!y(a))return`The field "${t}" must be a valid phone number.`;if(n.test==="ipAddress"&&!w(a))return`The field "${t}" must be a valid IPv4 address.`;if(n.test==="url"&&!T(a))return`The field "${t}" must be a valid IPv4 address.`;if(typeof r[t]!="string")return`The field "${t}" must be a string.`}if(s.checks){for(let n of s.checks)if(!await n.run(t))return`${n.response}.`}if(s.type==="boolean"&&typeof r[t]!="boolean")return`The field "${t}" must be a boolean.`;if(s.type==="object"){if(typeof r[t]!="object")return`The field "${t}" must be an object.`;if(s.properties){let n=await v(r[t],s.properties);if(n)return n}}if(s.type==="array"){if(!Array.isArray(r[t]))return`The field "${t}" must be an array.`;if(s.items)for(let n of r[t]){if(typeof n!==s.items.type)return`The field "${t}" must be an array of ${s.items.type}.`;if(!s.items.enum.includes(n))return`The field "${t}" must be an array of valid options.`}}if(s.type==="image"){if(typeof r[t]!="string")return`The field "${t}" must be a string.`;if(!x(r[t]))return`The field "${t}" must be a valid image.`}}return!1},N=async(r,e,i)=>{let t=await v(r,e);return t?i.status(400).json({status:400,message:t}):null},h=N;import{startSession as q}from"mongoose";var P=async(r,e,i,t)=>{let s=await q();try{s.startTransaction(),await r(e,i,s),await s.commitTransaction(),t()}catch(n){await s.abortTransaction(),m.error(n),i.status(500).json({error:"Internal Server Error"})}finally{s.endSession()}},b=r=>(e,i,t)=>{P(r,e,i,t)};var l=class{disabled;name;description;url;method;notes;paramSchema;querySchema;bodySchema;responses;controller;constructor(){this.disabled=!1,this.name="Name not provided",this.description="Description not provided",this.url="/",this.method="GET",this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setDisabled(e){return this.disabled=e,this}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}setNotes(e){return this.notes=e,this}setParamSchema(e){return this.paramSchema=e.schema,this}setQuerySchema(e){return this.querySchema=e.schema,this}setBodySchema(e){return this.bodySchema=e.schema,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=b(e),this}execute=(e,i,t)=>{(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?i.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await h(e.params,this.paramSchema,i)||this.querySchema&&await h(e.query,this.querySchema,i)||this.bodySchema&&await h(e.body,this.bodySchema,i)?void 0:this.controller(e,i,t)}catch(s){m.error(s)}})()}};import{Router as B}from"express";var p=class{raw=B();route;name;description;endpoints=[];middlewares=[];constructor(){this.route="/",this.name="Unnamed route",this.description="No description provided.",this.endpoints=[]}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setRoute(e){return this.route=e,this}addMiddleware(e){return this.middlewares.push(e),this}addEndpoint(e){this.endpoints.push(e);let i=`${this.route}${e.url}`.replace("//","/");switch(e.method){case"GET":this.raw.get(i,...this.middlewares,e.controller);break;case"POST":this.raw.post(i,...this.middlewares,e.controller);break;case"PUT":this.raw.put(i,...this.middlewares,e.controller);break;case"PATCH":this.raw.patch(i,...this.middlewares,e.controller);break;case"DELETE":this.raw.delete(i,...this.middlewares,e.controller);break;case"OPTIONS":this.raw.options(i,...this.middlewares,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let i of Object.values(e))this.addEndpoint(i);return this}use(e,i){if(!e)return this;let t=/\/+/g;return this.raw.use(e.replace(t,"/"),i.raw),this}};var u=class{name;type;typeSchema;description;required;options;enum;items;min;max;checks;properties;test;constructor(e){this.name="Name not provided",this.type=e,this.description="Description not provided",this.required=!0}setName(e){return this.name=e,this}setTypeSchema(e){return this.typeSchema=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}setOptions(e){return this.options=e,this}setEnum(e){return this.enum=e,this}setItems(e){return this.items=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setChecks(e){return this.checks=e,this}setProperties(e){return this.properties=e,this}setTest(e){return this.test=e,this}},d=class{schema;constructor(){this.schema={}}addStringValue=e=>{let i=new u("string");return e(i),this.schema[i.name]=i,this};addNumberValue=e=>{let i=new u("number");return e(i),this.schema[i.name]=i,this};addIntegerValue=e=>{let i=new u("integer");return e(i),this.schema[i.name]=i,this};addBooleanValue=e=>{let i=new u("boolean");return e(i),this.schema[i.name]=i,this};addObjectValue=e=>{let i=new u("object");return e(i),this.schema[i.name]=i,this};addArrayValue=e=>{let i=new u("array");return e(i),this.schema[i.name]=i,this};addImageValue=e=>{let i=new u("image");return e(i),this.schema[i.name]=i,this}};I.config();var fe=A;export{l as EndpointBuilder,p as RouteBuilder,d as SchemaBuilder,fe as default};
//# sourceMappingURL=index.mjs.map