import O from"dotenv";import I from"express";import h from"colors";import*as a from"winston";var $=!!process.env.DEBUG,E=r=>{switch(r){case"error":return h.red(r.toUpperCase());case"warn":return h.yellow(r.toUpperCase());case"info":return h.green(r.toUpperCase());case"debug":return h.blue(r.toUpperCase());case"trace":return h.magenta(r.toUpperCase());default:return h.white(r.toUpperCase())}},C=a.format.combine(a.format.colorize(),a.format.timestamp(),a.format.ms(),a.format.errors({stack:!0}),a.format.printf(({timestamp:r,ms:e,level:i,message:t,stack:s})=>{let n=t;s&&(n+=`
${s}`);let o=/\u001b\[[0-9]{1,2}m/gi;return`${h.gray(r)} (${h.magenta(e)}) [${E(i.replace(o,""))}]: ${n}`})),k=a.createLogger({level:"debug",format:C,transports:[new a.transports.Console({level:$?"debug":"info"}),new a.transports.Console({level:"error"}),new a.transports.Console({level:"warn"}),new a.transports.Console({level:"trace"})]}),p=k;var g=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),w=r=>/^[a-zA-Z0-9_]{3,16}$/.test(r),y=r=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(r),S=r=>/^\d{10}$/.test(r),x=r=>/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}$/.test(r);var T=r=>{try{return new URL(r).href===r}catch{return!1}},v=r=>{try{return new URL(r).href===r}catch{return!1}};var R=async(r,e)=>{if(typeof r!="object")return"The data provided must be an object.";let i=Object.entries(e);for(let[t,s]of i)if(s.required&&!r[t])return`The field "${t}" has not been provided.`;for(let[t,s]of i)if(typeof r[t]!==s.type)return`The field "${t}" must be of type ${s.type}.`;for(let[t,s]of i){if(s.options&&!s.options.includes(r[t]))return`The field "${t}" is not a valid option.`;if(s.type==="number"){if(s.min&&s.max&&typeof r[t]=="number"&&(r[t]<s.min||r[t]>s.max))return`The field "${t}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof r[t]=="number"&&r[t]<s.min)return`The field "${t}" must be at least ${s.min}.`;if(s.max&&typeof r[t]=="number"&&r[t]>s.max)return`The field "${t}" must be less than ${s.max}.`}if(s.type==="integer"){if(s.min&&s.max&&typeof r[t]=="number"&&(r[t]<s.min||r[t]>s.max))return`The field "${t}" must be between ${s.min} and ${s.max}.`;if(s.min&&typeof r[t]=="number"&&r[t]<s.min)return`The field "${t}" must be at least ${s.min}.`;if(s.max&&typeof r[t]=="number"&&r[t]>s.max)return`The field "${t}" must be less than ${s.max}.`;if(typeof r[t]!="number"||!Number.isInteger(r[t]))return`The field "${t}" must be an integer.`}if(s.type==="string"){let n=s,o=r[t];if(s.min&&s.max&&(o.length<s.min||o.length>s.max))return`The field "${t}" must be between ${s.min} and ${s.max} characters.`;if(s.min&&o.length<s.min)return`The field "${t}" must be at least ${s.min} characters.`;if(s.max&&o.length>s.max)return`The field "${t}" must be less than ${s.max} characters.`;if(n.test==="email"&&!g(o))return`The field "${t}" must be a valid email address.`;if(n.test==="username"&&!w(o))return`The field "${t}" must be a valid username.`;if(n.test==="passwordStrength"&&!y(o))return`The field "${t}" is too weak to be a valid password.`;if(n.test==="phoneNumber"&&!S(o))return`The field "${t}" must be a valid phone number.`;if(n.test==="ipAddress"&&!x(o))return`The field "${t}" must be a valid IPv4 address.`;if(n.test==="url"&&!T(o))return`The field "${t}" must be a valid IPv4 address.`;if(typeof r[t]!="string")return`The field "${t}" must be a string.`}if(s.checks){for(let n of s.checks)if(!await n.run(t))return`${n.response}.`}if(s.type==="boolean"&&typeof r[t]!="boolean")return`The field "${t}" must be a boolean.`;if(s.type==="object"){if(typeof r[t]!="object")return`The field "${t}" must be an object.`;if(s.properties){let n=await R(r[t],s.properties);if(n)return n}}if(s.type==="array"){if(!Array.isArray(r[t]))return`The field "${t}" must be an array.`;if(s.items)for(let n of r[t]){if(typeof n!==s.items.type)return`The field "${t}" must be an array of ${s.items.type}.`;if(!s.items.enum.includes(n))return`The field "${t}" must be an array of valid options.`}}if(s.type==="image"){if(typeof r[t]!="string")return`The field "${t}" must be a string.`;if(!v(r[t]))return`The field "${t}" must be a valid image.`}}return!1},N=async(r,e,i)=>{let t=await R(r,e);return t?i.status(400).json({status:400,message:t}):null},c=N;import{startSession as B}from"mongoose";var q=async(r,e,i,t)=>{let s=await B();try{s.startTransaction(),await r(e,i,s),await s.commitTransaction(),t()}catch(n){await s.abortTransaction(),p.error(n),i.status(500).json({error:"Internal Server Error"})}finally{s.endSession()}},f=r=>(e,i,t)=>{q(r,e,i,t)};var u=class{name;type;typeSchema;description;required;options;enum;items;min;max;checks;properties;test;constructor(e){this.name="Name not provided",this.type=e,this.description="Description not provided",this.required=!0}setName(e){return this.name=e,this}setTypeSchema(e){return this.typeSchema=e,this}setDescription(e){return this.description=e,this}setRequired(e){return this.required=e,this}setOptions(e){return this.options=e,this}setEnum(e){return this.enum=e,this}setItems(e){return this.items=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setChecks(e){return this.checks=e,this}setProperties(e){return this.properties=e,this}setTest(e){return this.test=e,this}};var m=class{schema;constructor(){this.schema={}}addStringValue(e){let i=new u("string");return e(i),this.schema[i.name]=i,this}addNumberValue(e){let i=new u("number");return e(i),this.schema[i.name]=i,this}addIntegerValue(e){let i=new u("integer");return e(i),this.schema[i.name]=i,this}addBooleanValue(e){let i=new u("boolean");return e(i),this.schema[i.name]=i,this}addObjectValue(e){let i=new u("object");return e(i),this.schema[i.name]=i,this}addArrayValue(e){let i=new u("array");return e(i),this.schema[i.name]=i,this}addImageValue(e){let i=new u("image");return e(i),this.schema[i.name]=i,this}};var l=class{disabled;name;description;path;method;notes;paramSchema;querySchema;bodySchema;responses;controller;constructor(){this.disabled=!1,this.name="Name not provided",this.description="Description not provided",this.path="/",this.method="GET",this.notes=[],this.responses=[],this.controller=()=>{throw new Error("Controller not set")}}setDisabled(e){return this.disabled=e,this}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}setMethod(e){return this.method=e,this}setNotes(e){return this.notes=e,this}setParamSchema(e){let i=new m;return e(i),this.paramSchema=i.schema,this}setQuerySchema(e){let i=new m;return e(i),this.querySchema=i.schema,this}setBodySchema(e){let i=new m;return e(i),this.bodySchema=i.schema,this}setResponses(e){return this.responses=e,this}setController(e){return this.controller=f(e),this}execute(e,i,t){(async()=>{try{return!this.paramSchema&&!this.querySchema&&!this.bodySchema?i.status(500).json({status:500,message:"Schema not set for endpoint."}):this.paramSchema&&await c(e.params,this.paramSchema,i)||this.querySchema&&await c(e.query,this.querySchema,i)||this.bodySchema&&await c(e.body,this.bodySchema,i)?void 0:this.controller(e,i,t)}catch(s){p.error(s)}})()}export(){return{name:this.name,description:this.description,path:this.path==="/"?"":this.path,method:this.method,notes:this.notes,params:this.paramSchema??{},query:this.querySchema??{},body:this.bodySchema??{},responses:this.responses}}};import{Router as A}from"express";var d=class{raw=A();path;name;description;endpoints=[];middlewares=[];afterwares=[];constructor(e){this.path=e??"/",this.name="Unnamed route",this.description="No description provided."}setName(e){return this.name=e,this}setDescription(e){return this.description=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addEndpoint(e){this.endpoints.push(e);let i=/\/+/g,t=`${this.path}${e.path}`.replace(i,"/");switch(e.method){case"GET":this.raw.get(t,...this.middlewares,e.controller);break;case"POST":this.raw.post(t,...this.middlewares,e.controller);break;case"PUT":this.raw.put(t,...this.middlewares,e.controller);break;case"PATCH":this.raw.patch(t,...this.middlewares,e.controller);break;case"DELETE":this.raw.delete(t,...this.middlewares,e.controller);break;case"OPTIONS":this.raw.options(t,...this.middlewares,e.controller);break;default:throw new Error(`Invalid method ${String(e.method)}`)}return this}addEndpointFile(e){for(let i of Object.values(e))this.addEndpoint(i);return this}access(){return{middlewares:this.middlewares,afterwares:this.afterwares}}export(){return{name:this.name,description:this.description,path:this.path,endpoints:this.endpoints.map(e=>e.export())}}};import{Router as M}from"express";var b=class{raw=M();path;defaultCategory;routes=[];middlewares=[];afterwares=[];constructor(){this.path="/",this.defaultCategory="No default category"}setDefaultCategory(e){return this.defaultCategory=e,this}setPath(e){return this.path=e,this}addMiddleware(e){return this.middlewares.push(e),this}addAfterware(e){return this.afterwares.push(e),this}addRoute(e){this.routes.push(e);let i=e.access();return this.raw.use("/",...i.middlewares,e.raw,...i.afterwares),this}getRouter=()=>this.raw;export(){return{name:this.defaultCategory,path:this.path,routes:this.routes.map(e=>e.export())}}async generateSite(){return p.info("Generating site..."),await(()=>new Promise(i=>{setTimeout(()=>{i(null)},1e3)}))(),p.error("Site generation has not been implemented yet."),this}};O.config();var xe=I;export{l as EndpointBuilder,d as RouteBuilder,b as RouterBuilder,xe as default};
//# sourceMappingURL=index.mjs.map